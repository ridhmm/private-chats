<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Chat Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body class="bg-slate-900 text-white font-sans h-screen flex flex-col">

    <div id="setup-container" class="m-auto w-full max-w-md p-6 bg-slate-800 rounded-2xl shadow-2xl">
        <h1 class="text-2xl font-bold mb-6 text-center text-indigo-400">Private Room</h1>
        <div class="space-y-4">
            <input type="text" id="username" placeholder="Nama Anda" class="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <input type="text" id="room-id" placeholder="Kode Ruangan (Contoh: Z666)" class="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <button onclick="joinRoom()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-lg transition">Masuk Chat</button>
        </div>
    </div>

    <div id="chat-container" class="hidden flex-col h-screen max-w-2xl mx-auto w-full border-x border-slate-700">
        <div class="p-4 bg-slate-800 border-b border-slate-700 flex justify-between items-center">
            <h2 class="font-bold text-indigo-400">Room: <span id="display-room"></span></h2>
            <button onclick="location.reload()" class="text-xs bg-red-500/20 text-red-400 px-3 py-1 rounded-full hover:bg-red-500 hover:text-white transition">Hancurkan Chat</button>
        </div>

        <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-900">
            </div>

        <div class="p-4 bg-slate-800 border-t border-slate-700 flex gap-2">
            <input type="text" id="msg-input" placeholder="Tulis pesan..." class="flex-1 p-3 rounded-full bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <button onclick="sendMsg()" class="bg-indigo-600 p-3 rounded-full hover:bg-indigo-500 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 fill-current" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </div>
    </div>

    <script>
        const socket = io();
        let currentRoom = "";
        let myUsername = "";

        function joinRoom() {
            myUsername = document.getElementById('username').value;
            currentRoom = document.getElementById('room-id').value;

            if (myUsername && currentRoom) {
                document.getElementById('setup-container').classList.add('hidden');
                document.getElementById('chat-container').classList.remove('hidden');
                document.getElementById('display-room').innerText = currentRoom;
                
                socket.emit('join', {username: myUsername, room: currentRoom});
            } else {
                alert("Isi nama dan kode room!");
            }
        }

        socket.on('status', function(data) {
            const div = document.createElement('div');
            div.className = "text-center text-xs text-slate-500 my-2";
            div.innerText = data.msg;
            document.getElementById('messages').appendChild(div);
        });

        socket.on('new_message', function(data) {
            const isMe = data.user === myUsername;
            const msgDiv = document.createElement('div');
            msgDiv.className = `flex ${isMe ? 'justify-end' : 'justify-start'}`;
            
            msgDiv.innerHTML = `
                <div class="max-w-[80%] ${isMe ? 'bg-indigo-600 rounded-l-2xl rounded-tr-2xl' : 'bg-slate-700 rounded-r-2xl rounded-tl-2xl'} p-3 shadow-md">
                    <p class="text-[10px] opacity-50 mb-1">${data.user}</p>
                    <p class="text-sm">${data.msg}</p>
                </div>
            `;
            const container = document.getElementById('messages');
            container.appendChild(msgDiv);
            container.scrollTop = container.scrollHeight;
        });

        function sendMsg() {
            const input = document.getElementById('msg-input');
            if (input.value.trim() !== "") {
                socket.emit('message', {
                    message: input.value, 
                    room: currentRoom, 
                    username: myUsername
                });
                input.value = '';
            }
        }

        // Kirim pesan pakai tombol Enter
        document.getElementById('msg-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMsg();
        });
    </script>
</body>
</html>